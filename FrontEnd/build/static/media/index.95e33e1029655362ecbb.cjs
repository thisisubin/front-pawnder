"use strict";var w3cKeyname=require("w3c-keyname"),prosemirrorState=require("prosemirror-state"),mac="undefined"!=typeof navigator&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),windows="undefined"!=typeof navigator&&/Win/.test(navigator.platform);function normalizeKeyName(e){var t,r,a,i,n=e.split(/-(?!$)/),o=n[n.length-1];"Space"==o&&(o=" ");for(var s=0;s<n.length-1;s++){var l=n[s];if(/^(cmd|meta|m)$/i.test(l))i=!0;else if(/^a(lt)?$/i.test(l))t=!0;else if(/^(c|ctrl|control)$/i.test(l))r=!0;else if(/^s(hift)?$/i.test(l))a=!0;else{if(!/^mod$/i.test(l))throw new Error("Unrecognized modifier name: "+l);mac?i=!0:r=!0}}return t&&(o="Alt-"+o),r&&(o="Ctrl-"+o),i&&(o="Meta-"+o),a&&(o="Shift-"+o),o}function normalize(e){var t=Object.create(null);for(var r in e)t[normalizeKeyName(r)]=e[r];return t}function modifiers(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return t.altKey&&(e="Alt-"+e),t.ctrlKey&&(e="Ctrl-"+e),t.metaKey&&(e="Meta-"+e),r&&t.shiftKey&&(e="Shift-"+e),e}function keymap(e){return new prosemirrorState.Plugin({props:{handleKeyDown:keydownHandler(e)}})}function keydownHandler(e){var t=normalize(e);return function(e,r){var a,i=w3cKeyname.keyName(r),n=t[modifiers(i,r)];if(n&&n(e.state,e.dispatch,e))return!0;if(1==i.length&&" "!=i){if(r.shiftKey){var o=t[modifiers(i,r,!1)];if(o&&o(e.state,e.dispatch,e))return!0}if((r.altKey||r.metaKey||r.ctrlKey)&&!(windows&&r.ctrlKey&&r.altKey)&&(a=w3cKeyname.base[r.keyCode])&&a!=i){var s=t[modifiers(a,r)];if(s&&s(e.state,e.dispatch,e))return!0}}return!1}}exports.keydownHandler=keydownHandler,exports.keymap=keymap;